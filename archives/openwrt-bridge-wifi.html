<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title>OpenWrt同网段桥接配置 · ILOFT · 我的阁楼</title><meta name="description" content="OpenWrt同网段桥接配置 - Yu"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://www.iloft.xyz/atom.xml" title="ILOFT · 我的阁楼"><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="ILOFT · 我的阁楼" type="application/atom+xml">
</head><body><div class="wrap"><header><a class="logo-link" href="/"><img src="/logo.svg" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a class="nav-list-link" href="/" target="_self">LOFT</a></li><li class="nav-list-item"><a class="nav-list-link" href="/archives/" target="_self">ARCHIVE</a></li><li class="nav-list-item"><a class="nav-list-link" href="/about/" target="_self">ABOUT</a></li><li class="nav-list-item"><a class="nav-list-link" href="/links/" target="_self">LINKS</a></li><li class="nav-list-item"><a class="nav-list-link" href="/atom.xml" target="_self">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">OpenWrt同网段桥接配置</h1><div class="post-info">2019年6月30日</div><div class="post-content"><p>　　最近组了个ITX主机，丐版主板不带无线网卡，坐的地方也没网口。因此尝试主机用网线连接从路由器，路由器之间通过WIFI桥接。</p><span id="more"></span><p>　　主路由器为K3，从路由器为K2P同配置的友华1200js。家里的网段为172.16.0.0&#x2F;16，主路由器网关为172.16.0.1。尝试了两种方法来实现两路由器下设备在同一网段。</p><h2 id="优雅的方法（LAN-Bridge）"><a href="#优雅的方法（LAN-Bridge）" class="headerlink" title="优雅的方法（LAN Bridge）"></a>优雅的方法（LAN Bridge）</h2><p>　　比较优雅的方法是将从路由设置的IP设置在同一网段，如172.16.0.2，并关闭DHCP。按正常方式扫描WIFI并加入网络，再将接口从WWAN修改为LAN，最后删除自动创建的WWAN接口即可完成配置。<br><img src="/images/wwan-2-lan.jpg" alt="修改Network"><br>　　这种直接桥接的方式最为优雅，主路由器、从路由器、各路由器下的设备都在同一网段，无需路由器转发通讯。然而实际配置时出现了无线无法启动的问题。<br><img src="/images/wireless-not-associated.jpg" alt="无线无法启动"><br>　　经过搜索发现MT7615的驱动并不支持Wireless与Lan桥接模式。但在另一台路由器EA6350上成功实现。<br><img src="/images/bridge-not-allowed.jpg" alt="系统日志"></p><h2 id="通用方法（Relay）"><a href="#通用方法（Relay）" class="headerlink" title="通用方法（Relay）"></a>通用方法（Relay）</h2><p>　　通用的方法是对LAN与WWAN进行转发，效率没有直接桥接高。</p><h4 id="加入网络"><a href="#加入网络" class="headerlink" title="加入网络"></a>加入网络</h4><p>　　这种方式从路由器与主路由器不在同一网段，如192.168.1.1，关闭DHCP。按正常方式扫描WIFI并加入网络。此时可以通过设置PC的网关为192.168.1.1正常上网。<br><img src="/images/join-wireless.jpg" alt="加入网络"></p><h4 id="安装软件包"><a href="#安装软件包" class="headerlink" title="安装软件包"></a>安装软件包</h4><p>　　为了实现转发，需要安装relayd和luci-proto-relay两个包，如果是一些定制固件可能已经包含了。</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">opkg update</span><br><span class="line">opkg <span class="keyword">install</span> luci-proto-relay</span><br></pre></td></tr></table></figure><h4 id="创建转发"><a href="#创建转发" class="headerlink" title="创建转发"></a>创建转发</h4><p>　　在网络接口点击创建新的网络接口，如命名为RELAY，选择接口类型为Relay bridge。<br><img src="/images/create-interface.jpg" alt="创建网络接口"><br>　　配置上一步创建的RELAY接口，将lan和wwan加入转发。<br><img src="/images/relay-configuration.jpg" alt="配置网络接口"></p><h4 id="配置防火墙"><a href="#配置防火墙" class="headerlink" title="配置防火墙"></a>配置防火墙</h4><p>　　完成转发配置之后需要配置防火墙，将Forward修改为为accept。<br><img src="/images/firewall-configuration.jpg" alt="配置防火墙"></p><h4 id="测试网络"><a href="#测试网络" class="headerlink" title="测试网络"></a>测试网络</h4><p>　　此时从路由器下的设备就可以通过DHCP获得正确的IP地址和网关了，可以正常联网并与局域网内的设备进行通信了。由于采用了Relay方式，路由追踪略微有些美中不足。<br><img src="/images/test-network.jpg" alt="测试网络"></p></div></article></div></main><footer><div class="paginator"><a class="prev" href="/archives/interview-record.html">上一篇</a><a class="next" href="/archives/travisci-hexo-cos.html">下一篇</a></div><div id="giscus"></div><script src="https://giscus.app/client.js" data-repo="myloft/blog" data-repo-id="MDEwOlJlcG9zaXRvcnk5MTQ0MTQ5Nw==" data-category="Announcements" data-category-id="DIC_kwDOBXNJWc4CT54-" data-mapping="  mapping: pathname" data-strict="0" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="bottom" data-theme="preferred_color_scheme" data-lang="zh-CN" crossorigin="anonymous" async>></script><div class="copyright"><p>© 2013 - 2025 <a href="https://www.iloft.xyz">Yu</a>, Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> <a href="/sitemap.xml" target="_blank">Sitemap</a></p><p><a href="https://beian.miit.gov.cn/" target="_blank">苏ICP备16033901号-3</a></p></div></footer></div><script>!function(e,a,t,n,g,c){e.GoogleAnalyticsObject=n,e.ga||(e.ga=function(){(e.ga.q=e.ga.q||[]).push(arguments)}),e.ga.l=+new Date,g=a.createElement(t),c=a.getElementsByTagName(t)[0],g.src="//www.google-analytics.com/analytics.js",c.parentNode.insertBefore(g,c)}(window,document,"script","ga"),ga("create","UA-89639365-1","auto"),ga("send","pageview")</script></body></html>