<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title>SARS 2019 第五次打卡（JWT） · ILOFT · 我的阁楼</title><meta name="description" content="SARS 2019 第五次打卡（JWT） - Yu"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://www.iloft.xyz/atom.xml" title="ILOFT · 我的阁楼"><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="ILOFT · 我的阁楼" type="application/atom+xml">
</head><body><div class="wrap"><header><a class="logo-link" href="/"><img src="/logo.svg" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a class="nav-list-link" href="/" target="_self">LOFT</a></li><li class="nav-list-item"><a class="nav-list-link" href="/archives/" target="_self">ARCHIVE</a></li><li class="nav-list-item"><a class="nav-list-link" href="/about/" target="_self">ABOUT</a></li><li class="nav-list-item"><a class="nav-list-link" href="/links/" target="_self">LINKS</a></li><li class="nav-list-item"><a class="nav-list-link" href="/atom.xml" target="_self">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">SARS 2019 第五次打卡（JWT）</h1><div class="post-info">2019年9月12日</div><div class="post-content"><p>　　由于同学们报名的热情太高涨，打卡任务被张老师改成了两天一打，说实话压力还是蛮大的。本想写道算法题完成打卡，点开 GitHub 第三方登录时，对其中的原理产生了兴趣，对其中的常见概念进行了简单的学习与记录，由于时间紧促难免存在理解不到位。<span id="more"></span></p><h3 id="Cookie-Session"><a href="#Cookie-Session" class="headerlink" title="Cookie &amp; Session"></a>Cookie &amp; Session</h3><p>　　由于 Http 具有无状态性，因此一般使用 Cookie &amp; Session 保存用户的登录状态。</p><h4 id="验证流程"><a href="#验证流程" class="headerlink" title="验证流程"></a>验证流程</h4><ol><li>用户向服务器发送用户名和密码。</li><li>服务器验证用户提交的用户名和密码，将当前用户的信息和状态保存到 Session 生成对应的 Session id，保存到浏览器 Cookie 中。</li><li>用户此后的请求中携带着包含 Session id 的 Cookie。</li><li>服务器根据 Session id 读取相应的 Session。</li></ol><p>　　使用 Cookie &amp; Session 虽然解决了用户状态问题但存在着一些弊端。</p><h4 id="弊端"><a href="#弊端" class="headerlink" title="弊端"></a>弊端</h4><ol><li>需要在服务器端保存大量数据，不利于服务器的水平扩展。</li><li>易遭受跨域攻击。</li></ol><h3 id="Token"><a href="#Token" class="headerlink" title="Token"></a>Token</h3><p>　　由于 Session 的弊端，Token 将用户状态保存在客户端中，认证流程与使用 Cookie &amp; Session 方式相似。</p><h4 id="验证流程-1"><a href="#验证流程-1" class="headerlink" title="验证流程"></a>验证流程</h4><ol><li>用户向服务器发送用户名和密码。</li><li>服务器验证用户提交的用户名和密码，将用户信息加密生成 Token 返回给用户，用户将其存储 localstorage 等容器中。</li><li>用户下次请求时将 Token 放入 Header、Body 、URL 中的一种。</li><li>服务器将用户传来的 Token 解密，就可以确定用户的身份了。</li></ol><h4 id="优势"><a href="#优势" class="headerlink" title="优势"></a>优势</h4><ol><li>可以用于 Restful API 中。</li><li>以时间（Token 解密）换取空间（Session），解决了水平扩展的问题。</li><li>可以抵御跨域攻击。</li></ol><h3 id="JWT-JSON-Web-Token"><a href="#JWT-JSON-Web-Token" class="headerlink" title="JWT(JSON Web Token)"></a>JWT(JSON Web Token)</h3><p>　　JWT 是一种 Token 的实现标准（RFC 7519），JWT 由三部分组成。</p><h4 id="Header（头部）"><a href="#Header（头部）" class="headerlink" title="Header（头部）"></a>Header（头部）</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;typ&quot;</span><span class="punctuation">:</span> <span class="string">&quot;JWT&quot;</span><span class="punctuation">,</span></span><br><span class="line"> <span class="attr">&quot;alg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;HS256&quot;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><ol><li><code>typ</code>:Token 的类型（type）。</li><li><code>alg</code>: 签名算法（algorithm），默认使用 HMAC SHA256，缩写为 HS256。</li></ol><h4 id="Payload（负载）"><a href="#Payload（负载）" class="headerlink" title="Payload（负载）"></a>Payload（负载）</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;iss&quot;</span><span class="punctuation">:</span><span class="string">&quot;joe&quot;</span><span class="punctuation">,</span></span><br><span class="line"> <span class="attr">&quot;exp&quot;</span><span class="punctuation">:</span><span class="number">1300819380</span><span class="punctuation">,</span></span><br><span class="line"> <span class="attr">&quot;http://example.com/is_root&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">true</span></span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>　　RFC 7519 规定了七种保留字段以供选用，除此以外可以自行定义。</p><ol><li><code>iss</code>: 签发人（Issuer）。</li><li><code>sub</code>: 主题（Subject）。</li><li><code>aud</code>: 受众（Audience）。</li><li><code>exp</code>: 过期时间（Expiration Time）。</li><li><code>nbf</code>: 生效时间（Not Before）。</li><li><code>iat</code>: 签发时间（Issued At）。</li><li><code>jti</code>: 唯一编号（JWT ID）。</li></ol><h4 id="Signature（签名）"><a href="#Signature（签名）" class="headerlink" title="Signature（签名）"></a>Signature（签名）</h4><p>　　首先对 Header 和 Payload 进行 Base64Url 编码，指定一个密钥（secret），使用 Header 中的加密算法产生密钥。</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">HMACSHA256</span><span class="params">(base64UrlEncode(header)</span></span> + <span class="string">&quot;.&quot;</span> + <span class="built_in">base64UrlEncode</span>(payload), secret)</span><br></pre></td></tr></table></figure><p>　　算出 Signature 后以<code>Header.Payload.Signature</code>格式组成 JWT。</p><h4 id="弊端-1"><a href="#弊端-1" class="headerlink" title="弊端"></a>弊端</h4><ol><li>JWT 一旦泄露，所有人都能获取到其全部权限。</li><li>服务端无法注销 Token，只能等待过期。</li></ol></div></article></div></main><footer><div class="paginator"><a class="prev" href="/archives/github-action-hexo-cos.html">上一篇</a><a class="next" href="/archives/sars2019-4.html">下一篇</a></div><div id="giscus"></div><script src="https://giscus.app/client.js" data-repo="myloft/blog" data-repo-id="MDEwOlJlcG9zaXRvcnk5MTQ0MTQ5Nw==" data-category="Announcements" data-category-id="DIC_kwDOBXNJWc4CT54-" data-mapping="  mapping: pathname" data-strict="0" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="bottom" data-theme="preferred_color_scheme" data-lang="zh-CN" crossorigin="anonymous" async>></script><div class="copyright"><p>© 2013 - 2025 <a href="https://www.iloft.xyz">Yu</a>, Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> <a href="/sitemap.xml" target="_blank">Sitemap</a></p><p><a href="https://beian.miit.gov.cn/" target="_blank">苏ICP备16033901号-3</a></p></div></footer></div><script>!function(e,a,t,n,g,c){e.GoogleAnalyticsObject=n,e.ga||(e.ga=function(){(e.ga.q=e.ga.q||[]).push(arguments)}),e.ga.l=+new Date,g=a.createElement(t),c=a.getElementsByTagName(t)[0],g.src="//www.google-analytics.com/analytics.js",c.parentNode.insertBefore(g,c)}(window,document,"script","ga"),ga("create","UA-89639365-1","auto"),ga("send","pageview")</script></body></html>