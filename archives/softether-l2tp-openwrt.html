<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title>Openwrt使用Softether配置L2TP VPN · ILOFT · 我的阁楼</title><meta name="description" content="Openwrt使用Softether配置L2TP VPN - Yu"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://www.iloft.xyz/atom.xml" title="ILOFT · 我的阁楼"><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="ILOFT · 我的阁楼" type="application/atom+xml">
</head><body><div class="wrap"><header><a class="logo-link" href="/"><img src="/logo.svg" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a class="nav-list-link" href="/" target="_self">LOFT</a></li><li class="nav-list-item"><a class="nav-list-link" href="/archives/" target="_self">ARCHIVE</a></li><li class="nav-list-item"><a class="nav-list-link" href="/about/" target="_self">ABOUT</a></li><li class="nav-list-item"><a class="nav-list-link" href="/links/" target="_self">LINKS</a></li><li class="nav-list-item"><a class="nav-list-link" href="/atom.xml" target="_self">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">Openwrt使用Softether配置L2TP VPN</h1><div class="post-info">2019年3月22日</div><div class="post-content"><p>　　由于主流VPN协议被重点关照，所以之前在服务器上一直使用的Ocserv来配置Cisco的Anyconnect做游戏加速。沿用到路由器上发现并不好用，配置文件比较复杂，手机电脑还要装应用。所以尝试了一下弃用已久的Softether发现挺好用的。</p><span id="more"></span><h2 id="配置环境"><a href="#配置环境" class="headerlink" title="配置环境"></a>配置环境</h2><ol><li>Phicomm K3 Openwrt-18.06</li><li>Softethervpn(直接在软件包里搜索安装还是opkg安装，甚至自己编译，默认你装好了)</li><li>vpnsmgr(连接工具 官网下)</li></ol><h2 id="Softether配置"><a href="#Softether配置" class="headerlink" title="Softether配置"></a>Softether配置</h2><p>　　打开SoftEther VPN Server管理器，新建连接配置。填好设置名，以及路由器IP确定并连接。</p><p><img src="/images/new-softether.jpg" alt="新的连接设置"></p><p>　　第一次设置一下密码，勾选远程访问VPN Server下一步，确定初始化，虚拟HUB名默认就好。</p><p><img src="/images/remote-access.jpg" alt="新的连接设置"></p><p>　　直接退出动态DNS功能，Openwrt上已经配置了DDNS。勾选启用L2TP服务器功能（L2tp over IPsec），设置IPsec预共享密钥。确认并禁用VPN Azure。</p><p><img src="/images/l2tp.jpg" alt="开启L2tp"></p><p><img src="/images/vpn-azure.jpg" alt="禁用vpn azure"></p><p>　　关闭，到主界面，选择管理虚拟HUB，管理用户，新建用户。</p><p><img src="/images/new-user.jpg" alt="新建用户"></p><p>　　关闭，到主界面，选择本地网桥设置，选择之前创建的虚拟HUB，创建新tap设备的桥接，取个名字，创建本地桥。</p><p><img src="/images/new-tap.jpg" alt="创建本地网桥"></p><p>　　关闭，点击本地网桥，看到虚拟HUB和tap运行成功。Softether的配置就结束了。</p><h2 id="Openwrt配置"><a href="#Openwrt配置" class="headerlink" title="Openwrt配置"></a>Openwrt配置</h2><p>　　登录Openwrt点击网络-接口-编辑LAN-物理设置-接口，找到创建的tap并勾上，保存并应用。</p><p><img src="/images/openwrt-lan.jpg" alt="openwrt-lan"></p><p>　　点击网络-防火墙-流量规则，打开路由器端口，添加L2tp连接所需的端口。</p><table><thead><tr><th>名称</th><th>协议</th><th>外部端口</th></tr></thead><tbody><tr><td>L2TP</td><td>TCP + UDP</td><td>1701</td></tr><tr><td>IKE</td><td>UDP</td><td>500</td></tr><tr><td>IPsec</td><td>UDP</td><td>4500</td></tr></tbody></table><p><img src="/images/firewall-ruler.jpg" alt="防火墙规则"></p><p>　　到此为止，Softether的L2tp的配置就完成了，连接VPN的设备会和局域网内的设备在同一网段内，可以自由访问。</p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>　　路由器上用Softether VPN配置L2tp相较Ocserv基本是无脑下一步，几乎所有操作系统都原生支持连接，比较适合部署在路由器这种流量不会被干扰的设备上。</p></div></article></div></main><footer><div class="paginator"><a class="prev" href="/archives/travisci-hexo-cos.html">上一篇</a><a class="next" href="/archives/dq77kb-nas.html">下一篇</a></div><div id="giscus"></div><script src="https://giscus.app/client.js" data-repo="myloft/blog" data-repo-id="MDEwOlJlcG9zaXRvcnk5MTQ0MTQ5Nw==" data-category="Announcements" data-category-id="DIC_kwDOBXNJWc4CT54-" data-mapping="  mapping: pathname" data-strict="0" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="bottom" data-theme="preferred_color_scheme" data-lang="zh-CN" crossorigin="anonymous" async>></script><div class="copyright"><p>© 2013 - 2025 <a href="https://www.iloft.xyz">Yu</a>, Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> <a href="/sitemap.xml" target="_blank">Sitemap</a></p><p><a href="https://beian.miit.gov.cn/" target="_blank">苏ICP备16033901号-3</a></p></div></footer></div><script>!function(e,a,t,n,g,c){e.GoogleAnalyticsObject=n,e.ga||(e.ga=function(){(e.ga.q=e.ga.q||[]).push(arguments)}),e.ga.l=+new Date,g=a.createElement(t),c=a.getElementsByTagName(t)[0],g.src="//www.google-analytics.com/analytics.js",c.parentNode.insertBefore(g,c)}(window,document,"script","ga"),ga("create","UA-89639365-1","auto"),ga("send","pageview")</script></body></html>